<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Downloader - Multi API Backup System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .platform-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .platform-card:hover { transform: translateY(-5px); }
        
        .platform-card.active {
            border: 3px solid #667eea;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .platform-card.active span { color: #1f2937 !important; }
        
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .download-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .result-card { animation: slideUp 0.5s ease-out; }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top-color: #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .quality-badge {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .format-badge {
            background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
        }
        
        .api-badge {
            font-size: 0.65rem;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-weight: 600;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .toast.show { transform: translateX(0); }
    </style>
</head>
<body class="antialiased">

    <!-- Toast -->
    <div id="toast" class="toast flex items-center space-x-3">
        <i id="toastIcon" class="fas fa-check-circle text-green-500 text-xl"></i>
        <span id="toastMessage" class="font-medium">Notifikasi</span>
    </div>

    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-blue-500 rounded-xl flex items-center justify-center text-white text-xl">
                        <i class="fas fa-cloud-download-alt"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">AllDownloader</h1>
                        <p class="text-xs text-gray-500">Multi-API Backup System</p>
                    </div>
                </div>
                <div id="apiStatus" class="hidden sm:flex items-center space-x-2 px-3 py-1 bg-blue-100 rounded-full text-blue-700 text-xs font-semibold">
                    <i class="fas fa-server"></i>
                    <span id="apiStatusText">Ready</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="container mx-auto px-4 py-6 max-w-6xl">
        
        <!-- Hero -->
        <div class="text-center mb-8 text-white">
            <h2 class="text-3xl sm:text-4xl font-bold mb-3">Universal Downloader</h2>
            <p class="text-base opacity-90 max-w-xl mx-auto">
                Sistem backup berjenjang - API 1 → API 2 → API 3 otomatis
            </p>
        </div>

        <!-- Platform Selector -->
        <div class="glass-effect rounded-2xl p-4 sm:p-6 mb-6 shadow-2xl">
            <h3 class="text-base font-semibold text-gray-700 mb-4 text-center">Pilih Platform</h3>
            
            <div class="grid grid-cols-3 sm:grid-cols-4 lg:grid-cols-7 gap-3">
                <!-- TikTok -->
                <div class="platform-card active bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('tiktok', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-black rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fab fa-tiktok"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">TikTok</span>
                    <div class="mt-1 flex justify-center gap-1">
                        <span class="api-badge bg-blue-100 text-blue-700">1</span>
                        <span class="api-badge bg-yellow-100 text-yellow-700">2</span>
                    </div>
                </div>

                <!-- YouTube -->
                <div class="platform-card bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('youtube', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-red-600 rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">YouTube</span>
                    <div class="mt-1 flex justify-center gap-1">
                        <span class="api-badge bg-green-100 text-green-700">AIO</span>
                        <span class="api-badge bg-red-100 text-red-700">MP3</span>
                        <span class="api-badge bg-purple-100 text-purple-700">MP4</span>
                    </div>
                </div>

                <!-- Instagram -->
                <div class="platform-card bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('instagram', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fab fa-instagram"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">IG</span>
                    <div class="mt-1 flex justify-center gap-1">
                        <span class="api-badge bg-blue-100 text-blue-700">AIO</span>
                        <span class="api-badge bg-yellow-100 text-yellow-700">2</span>
                        <span class="api-badge bg-green-100 text-green-700">3</span>
                    </div>
                </div>

                <!-- Pinterest -->
                <div class="platform-card bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('pinterest', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-red-700 rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fab fa-pinterest-p"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">Pinterest</span>
                    <div class="mt-1 flex justify-center">
                        <span class="api-badge bg-blue-100 text-blue-700">API 1</span>
                    </div>
                </div>

                <!-- Spotify -->
                <div class="platform-card bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('spotify', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-green-500 rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fab fa-spotify"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">Spotify</span>
                    <div class="mt-1 flex justify-center gap-1">
                        <span class="api-badge bg-blue-100 text-blue-700">AIO</span>
                        <span class="api-badge bg-yellow-100 text-yellow-700">2</span>
                        <span class="api-badge bg-green-100 text-green-700">3</span>
                    </div>
                </div>

                <!-- MediaFire -->
                <div class="platform-card bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('mediafire', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-blue-500 rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fas fa-fire"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">MF</span>
                    <div class="mt-1 flex justify-center gap-1">
                        <span class="api-badge bg-blue-100 text-blue-700">AIO</span>
                        <span class="api-badge bg-yellow-100 text-yellow-700">MF</span>
                    </div>
                </div>

                <!-- Facebook -->
                <div class="platform-card bg-white rounded-xl p-3 text-center shadow-md" onclick="selectPlatform('facebook', this)">
                    <div class="w-10 h-10 mx-auto mb-1 bg-blue-600 rounded-full flex items-center justify-center text-white text-lg">
                        <i class="fab fa-facebook-f"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-xs block">FB</span>
                    <div class="mt-1 flex justify-center gap-1">
                        <span class="api-badge bg-blue-100 text-blue-700">AIO</span>
                        <span class="api-badge bg-yellow-100 text-yellow-700">2</span>
                        <span class="api-badge bg-green-100 text-green-700">3</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="glass-effect rounded-2xl p-6 shadow-2xl mb-6">
            <div class="max-w-3xl mx-auto">
                <label class="block text-gray-700 font-semibold mb-2 text-sm sm:text-base">
                    <i class="fas fa-link mr-2 text-purple-600"></i>
                    URL <span id="platformLabel" class="text-purple-600 bg-purple-100 px-2 py-1 rounded-full text-xs ml-2">TikTok</span>
                </label>
                
                <div class="relative">
                    <input type="url" id="urlInput" 
                           class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 input-focus outline-none text-gray-700 text-sm sm:text-base pr-28"
                           placeholder="https://www.tiktok.com/@username/video/123456..."
                           onkeypress="handleEnter(event)">
                    <button onclick="startDownload()" 
                            class="absolute right-2 top-2 bottom-2 download-btn text-white px-4 rounded-lg font-semibold text-sm flex items-center space-x-1">
                        <i class="fas fa-search"></i>
                        <span class="hidden sm:inline">Analisis</span>
                    </button>
                </div>
                
                <div class="flex items-center justify-between mt-2">
                    <p class="text-xs text-gray-500">
                        <i class="fas fa-shield-alt mr-1 text-green-500"></i>
                        <span id="hintText">Auto-backup system aktif</span>
                    </p>
                    <button onclick="pasteFromClipboard()" class="text-xs text-purple-600 hover:text-purple-800 font-medium">
                        <i class="fas fa-paste mr-1"></i>Paste
                    </button>
                </div>

                <!-- YouTube Format Selector -->
                <div id="ytSelector" class="hidden mt-3 flex gap-2">
                    <button onclick="setYtFormat('mp4')" id="btnMp4" class="flex-1 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold">
                        <i class="fas fa-video mr-1"></i>MP4 Video
                    </button>
                    <button onclick="setYtFormat('mp3')" id="btnMp3" class="flex-1 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold">
                        <i class="fas fa-music mr-1"></i>MP3 Audio
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loadingSection" class="hidden glass-effect rounded-2xl p-8 text-center shadow-2xl mb-6">
            <div class="loading-spinner mx-auto mb-3"></div>
            <h3 class="text-lg font-semibold text-gray-700 mb-1" id="loadingText">Menganalisis...</h3>
            <p class="text-sm text-gray-500" id="loadingSub">Menghubungi API 1...</p>
        </div>

        <!-- Results -->
        <div id="resultsSection" class="hidden glass-effect rounded-2xl p-4 sm:p-6 shadow-2xl">
            <div class="flex items-center justify-between mb-4 border-b pb-3">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                        <i class="fas fa-check text-sm"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800 text-sm sm:text-base">Hasil</h3>
                        <p class="text-xs text-gray-500" id="usedApi">API 1</p>
                    </div>
                </div>
                <button onclick="clearResults()" class="w-8 h-8 rounded-full hover:bg-red-50 text-gray-400 hover:text-red-500 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="resultsContent" class="space-y-3"></div>
        </div>

        <!-- Error -->
        <div id="errorSection" class="hidden glass-effect rounded-2xl p-6 shadow-2xl border-l-4 border-red-500 mb-6">
            <div class="flex items-center space-x-2 mb-2">
                <i class="fas fa-exclamation-triangle text-red-500"></i>
                <h3 class="font-bold text-gray-800">Semua API Gagal</h3>
            </div>
            <p id="errorMessage" class="text-sm text-gray-600 mb-3">Semua API tidak merespons</p>
            <button onclick="retryDownload()" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600">
                <i class="fas fa-redo mr-1"></i>Coba Lagi
            </button>
        </div>

        <!-- Info Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-8">
            <div class="glass-effect rounded-xl p-4 text-center">
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xl mx-auto mb-2">
                    <i class="fas fa-server"></i>
                </div>
                <h4 class="font-bold text-gray-800 text-sm">Triple Backup</h4>
                <p class="text-xs text-gray-600 mt-1">API 1 → 2 → 3</p>
            </div>
            <div class="glass-effect rounded-xl p-4 text-center">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-xl mx-auto mb-2">
                    <i class="fas fa-bolt"></i>
                </div>
                <h4 class="font-bold text-gray-800 text-sm">Cepat</h4>
                <p class="text-xs text-gray-600 mt-1">Response < 3 detik</p>
            </div>
            <div class="glass-effect rounded-xl p-4 text-center">
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600 text-xl mx-auto mb-2">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <h4 class="font-bold text-gray-800 text-sm">Responsive</h4>
                <p class="text-xs text-gray-600 mt-1">Mobile friendly</p>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="mt-12 bg-white bg-opacity-10 backdrop-blur-lg text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm mb-1">&copy; 2024 AllDownloader</p>
            <p class="text-xs opacity-75">Multi-API Backup System</p>
        </div>
    </footer>

    <script>
        // ============================================
        // API CONFIGURATION - ALL NEW APIs
        // ============================================
        
        const API_CONFIG = {
            // TIKTOK - API LAMA (tetap)
            tiktok: {
                primary: {
                    url: 'https://tikwm.com/api/',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: d.code === 0,
                        videoUrl: d.data?.play,
                        audioUrl: d.data?.music,
                        thumbnail: d.data?.cover,
                        author: d.data?.author?.nickname,
                        title: d.data?.title
                    })
                },
                backup: {
                    url: 'https://snapx.cab/api/tiktok',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!d.url,
                        videoUrl: d.url,
                        audioUrl: d.audioUrl,
                        thumbnail: d.thumbnail,
                        author: d.author,
                        title: d.title
                    })
                }
            },
            
            // YOUTUBE - API BARU
            youtube: {
                // AIO sebagai primary
                aio: {
                    url: 'https://api-faa.my.id/faa/aio',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => {
                        // AIO bisa return video atau audio, cek keduanya
                        const videoUrl = d.data?.video?.url || d.data?.download?.url;
                        const audioUrl = d.data?.audio?.url || d.data?.mp3?.url;
                        const title = d.data?.title || d.title;
                        
                        return {
                            success: !!(videoUrl || audioUrl),
                            title: title,
                            thumbnail: d.data?.thumbnail || d.thumbnail,
                            videoUrl: videoUrl,
                            audioUrl: audioUrl,
                            isAIO: true
                        };
                    }
                },
                mp3: {
                    url: 'https://api-faa.my.id/faa/ytmp3',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.url || d.data?.download?.url),
                        title: d.data?.title || d.title,
                        thumbnail: d.data?.thumbnail,
                        downloadUrl: d.data?.url || d.data?.download?.url,
                        quality: 'MP3 Audio',
                        format: 'mp3'
                    })
                },
                mp4: {
                    url: 'https://api-faa.my.id/faa/ytmp4',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.url || d.data?.download?.url),
                        title: d.data?.title || d.title,
                        thumbnail: d.data?.thumbnail,
                        downloadUrl: d.data?.url || d.data?.download?.url,
                        quality: d.data?.quality || 'HD',
                        format: 'mp4'
                    })
                }
            },
            
            // INSTAGRAM - API BARU (3 API)
            instagram: {
                primary: {
                    url: 'https://api-faa.my.id/faa/aio',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => {
                        const media = d.data?.media || d.data;
                        const items = Array.isArray(media) ? media : [media];
                        return {
                            success: items.length > 0 && (items[0].url || items[0].src),
                            items: items.map(i => ({
                                type: i.type || (i.url?.includes('.mp4') ? 'video' : 'image'),
                                url: i.url || i.src,
                                thumbnail: i.thumbnail || i.url
                            })).filter(i => i.url)
                        };
                    }
                },
                backup: {
                    url: 'https://api-faa.my.id/faa/igdl',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => {
                        const items = d.data || d.result || [];
                        return {
                            success: items.length > 0,
                            items: items.map(i => ({
                                type: i.type || 'image',
                                url: i.url || i.link || i.src,
                                thumbnail: i.thumbnail
                            }))
                        };
                    }
                },
                backup2: {
                    url: 'https://api.zenitsu.web.id/api/download/instagram',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => {
                        const result = d.result || d.data;
                        const items = Array.isArray(result) ? result : [result];
                        return {
                            success: items.length > 0 && (items[0].url || items[0].link),
                            items: items.map(i => ({
                                type: i.type || 'image',
                                url: i.url || i.link,
                                thumbnail: i.thumbnail
                            }))
                        };
                    }
                }
            },
            
            // FACEBOOK - API BARU (3 API)
            facebook: {
                primary: {
                    url: 'https://api-faa.my.id/faa/aio',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => {
                        const video = d.data?.video || d.data;
                        return {
                            success: !!(video?.url || video?.download?.url),
                            title: d.data?.title || video?.title || 'Facebook Video',
                            thumbnail: d.data?.thumbnail || video?.thumbnail,
                            formats: [{
                                quality: 'HD',
                                url: video?.url || video?.download?.url || video?.hd
                            }].filter(f => f.url)
                        };
                    }
                },
                backup: {
                    url: 'https://api-faa.my.id/faa/fbdownload',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.url || d.data?.download?.url || d.data?.hd),
                        title: d.data?.title || 'Facebook Video',
                        thumbnail: d.data?.thumbnail,
                        formats: [
                            { quality: 'HD', url: d.data?.hd || d.data?.url },
                            { quality: 'SD', url: d.data?.sd }
                        ].filter(f => f.url)
                    })
                },
                backup2: {
                    url: 'https://api.zenitsu.web.id/api/download/facebook',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.result?.url || d.result?.download?.url),
                        title: d.result?.title || 'Facebook Video',
                        thumbnail: d.result?.thumbnail,
                        formats: [{
                            quality: 'HD',
                            url: d.result?.url || d.result?.download?.url
                        }].filter(f => f.url)
                    })
                }
            },
            
            // SPOTIFY - API BARU (3 API)
            spotify: {
                primary: {
                    url: 'https://api-faa.my.id/faa/aio',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.audio?.url || d.data?.url),
                        title: d.data?.title || d.title,
                        artist: d.data?.artist || d.artist,
                        thumbnail: d.data?.thumbnail || d.thumbnail,
                        downloadUrl: d.data?.audio?.url || d.data?.url || d.data?.download?.url
                    })
                },
                backup: {
                    url: 'https://api.yupra.my.id/api/downloader/spotify',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.result?.download || d.result?.url),
                        title: d.result?.title || d.title,
                        artist: d.result?.artis || d.result?.artist,
                        thumbnail: d.result?.thumb || d.result?.thumbnail,
                        downloadUrl: d.result?.download || d.result?.url
                    })
                },
                backup2: {
                    url: 'https://api.zenitsu.web.id/api/download/spotify',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.result?.url || d.result?.download?.url),
                        title: d.result?.title,
                        artist: d.result?.artist,
                        thumbnail: d.result?.thumbnail,
                        downloadUrl: d.result?.url || d.result?.download?.url
                    })
                }
            },
            
            // MEDIAFIRE - API BARU (2 API)
            mediafire: {
                primary: {
                    url: 'https://api-faa.my.id/faa/aio',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.download?.url || d.data?.url),
                        filename: d.data?.filename || d.data?.name || d.data?.title || 'File',
                        size: d.data?.size || d.data?.filesize || 'Unknown',
                        downloadUrl: d.data?.download?.url || d.data?.url || d.data?.link
                    })
                },
                backup: {
                    url: 'https://api-faa.my.id/faa/mediafire',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.url || d.data?.download?.url || d.data?.link),
                        filename: d.data?.filename || d.data?.name || 'File',
                        size: d.data?.size || 'Unknown',
                        downloadUrl: d.data?.url || d.data?.download?.url || d.data?.link
                    })
                }
            },
            
            // PINTEREST - API BARU (1 API)
            pinterest: {
                primary: {
                    url: 'https://api-faa.my.id/faa/pin-down',
                    method: 'GET',
                    params: (u) => `?url=${encodeURIComponent(u)}`,
                    parser: (d) => ({
                        success: !!(d.data?.url || d.data?.image?.url || d.data?.download?.url),
                        title: d.data?.title || d.title || 'Pinterest Image',
                        downloadUrl: d.data?.url || d.data?.image?.url || d.data?.download?.url,
                        thumbnail: d.data?.thumbnail || d.data?.image?.thumbnail || d.data?.url
                    })
                }
            }
        };

        // ============================================
        // STATE
        // ============================================
        
        let currentPlatform = 'tiktok';
        let lastUrl = '';
        let ytFormat = 'mp4';
        let currentApiUsed = '';

        const hints = {
            tiktok: 'Video TikTok tanpa watermark',
            youtube: 'Pilih format MP3 atau MP4',
            instagram: 'Foto, video, reels, carousel',
            pinterest: 'Gambar dari Pinterest',
            spotify: 'Lagu Spotify ke MP3',
            mediafire: 'Direct download file',
            facebook: 'Video Facebook HD/SD'
        };

        const placeholders = {
            tiktok: 'https://www.tiktok.com/@username/video/...',
            youtube: 'https://youtube.com/watch?v=...',
            instagram: 'https://instagram.com/p/...',
            pinterest: 'https://pinterest.com/pin/...',
            spotify: 'https://open.spotify.com/track/...',
            mediafire: 'https://mediafire.com/file/...',
            facebook: 'https://facebook.com/watch?v=...'
        };

        // ============================================
        // UI FUNCTIONS
        // ============================================
        
        function selectPlatform(platform, el) {
            currentPlatform = platform;
            document.querySelectorAll('.platform-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            
            document.getElementById('platformLabel').textContent = platform.charAt(0).toUpperCase() + platform.slice(1);
            document.getElementById('hintText').textContent = hints[platform];
            document.getElementById('urlInput').placeholder = placeholders[platform];
            
            document.getElementById('ytSelector').style.display = platform === 'youtube' ? 'flex' : 'none';
            
            clearResults();
        }

        function setYtFormat(fmt) {
            ytFormat = fmt;
            document.getElementById('btnMp4').className = fmt === 'mp4' 
                ? 'flex-1 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold'
                : 'flex-1 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold';
            document.getElementById('btnMp3').className = fmt === 'mp3'
                ? 'flex-1 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold'
                : 'flex-1 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm font-semibold';
        }

        function handleEnter(e) { if (e.key === 'Enter') startDownload(); }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('urlInput').value = text;
                showToast('URL dipaste!', 'success');
            } catch (err) {
                showToast('Clipboard tidak diizinkan', 'error');
            }
        }

        function updateStatus(status, text) {
            const el = document.getElementById('apiStatus');
            const txt = document.getElementById('apiStatusText');
            el.className = `hidden sm:flex items-center space-x-2 px-3 py-1 rounded-full text-xs font-semibold ${
                status === 'error' ? 'bg-red-100 text-red-700' :
                status === 'backup' ? 'bg-yellow-100 text-yellow-700' :
                status === 'backup2' ? 'bg-orange-100 text-orange-700' :
                'bg-blue-100 text-blue-700'
            }`;
            txt.textContent = text;
            el.classList.remove('hidden');
        }

        // ============================================
        // API FUNCTIONS - MULTI BACKUP SYSTEM
        // ============================================
        
        async function tryApi(config, url) {
            const fullUrl = config.url + config.params(url);
            console.log('Trying:', fullUrl);
            
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 8000);
            
            try {
                const res = await fetch(fullUrl, {
                    method: config.method,
                    signal: controller.signal,
                    headers: { 'Accept': 'application/json' }
                });
                clearTimeout(timeout);
                
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const data = await res.json();
                console.log('Response:', data);
                
                const parsed = config.parser(data);
                console.log('Parsed:', parsed);
                
                if (!parsed.success) throw new Error('Invalid data');
                
                return { success: true, data: parsed, source: config.url };
                
            } catch (err) {
                console.error('API Error:', err.message);
                return { success: false, error: err.message };
            }
        }

        async function fetchWithBackup(platform, url) {
            const cfg = API_CONFIG[platform];
            if (!cfg) throw new Error('Platform tidak didukung');
            
            // YouTube special handling
            if (platform === 'youtube') {
                // Coba AIO dulu
                updateStatus('active', 'YouTube AIO');
                document.getElementById('loadingSub').textContent = 'Mencoba API AIO...';
                
                const aio = await tryApi(cfg.aio, url);
                if (aio.success) {
                    currentApiUsed = 'api-faa.my.id (AIO)';
                    
                    // Jika AIO berhasil, cek format yang diminta
                    if (ytFormat === 'mp3' && aio.data.audioUrl) {
                        return { ...aio.data, downloadUrl: aio.data.audioUrl, format: 'mp3' };
                    } else if (ytFormat === 'mp4' && aio.data.videoUrl) {
                        return { ...aio.data, downloadUrl: aio.data.videoUrl, format: 'mp4' };
                    }
                    // Jika format yang diminta tidak ada di AIO, lanjut ke specific API
                }
                
                // Fallback ke specific API
                const specificCfg = ytFormat === 'mp3' ? cfg.mp3 : cfg.mp4;
                updateStatus('backup', `YouTube ${ytFormat.toUpperCase()}`);
                document.getElementById('loadingSub').textContent = `Mencoba API ${ytFormat.toUpperCase()}...`;
                
                const specific = await tryApi(specificCfg, url);
                if (!specific.success) throw new Error(`YouTube ${ytFormat.toUpperCase()} gagal`);
                
                currentApiUsed = `api-faa.my.id (${ytFormat.toUpperCase()})`;
                return specific.data;
            }
            
            // Standard platform dengan multiple backups
            const apis = [];
            if (cfg.primary) apis.push({ name: 'API 1', config: cfg.primary, status: 'active' });
            if (cfg.backup) apis.push({ name: 'API 2', config: cfg.backup, status: 'backup' });
            if (cfg.backup2) apis.push({ name: 'API 3', config: cfg.backup2, status: 'backup2' });
            
            for (let i = 0; i < apis.length; i++) {
                const api = apis[i];
                updateStatus(api.status, api.name);
                document.getElementById('loadingSub').textContent = `Mencoba ${api.name}...`;
                
                const result = await tryApi(api.config, url);
                
                if (result.success) {
                    currentApiUsed = result.source.replace('https://', '').split('/')[0];
                    if (i > 0) showToast(`Menggunakan ${api.name}`, 'info');
                    return result.data;
                }
                
                console.log(`${api.name} failed, trying next...`);
            }
            
            throw new Error('Semua API gagal');
        }

        // ============================================
        // MAIN FUNCTION
        // ============================================
        
        async function startDownload() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return showToast('Masukkan URL!', 'error');
            
            lastUrl = url;
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('errorSection').classList.add('hidden');
            
            try {
                const data = await fetchWithBackup(currentPlatform, url);
                document.getElementById('loadingSection').classList.add('hidden');
                
                showResults(data);
                document.getElementById('usedApi').textContent = `Via: ${currentApiUsed}`;
                updateStatus('active', 'Ready');
                showToast('Berhasil!', 'success');
                
            } catch (err) {
                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('errorSection').classList.remove('hidden');
                document.getElementById('errorMessage').textContent = err.message;
                updateStatus('error', 'Error');
                showToast(err.message, 'error');
            }
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        
        function showResults(data) {
            const div = document.getElementById('resultsSection');
            const content = document.getElementById('resultsContent');
            div.classList.remove('hidden');
            
            const renderers = {
                tiktok: () => `
                    <div class="result-card bg-white rounded-xl p-4 shadow">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/3">
                                <div class="aspect-[9/16] bg-gray-100 rounded-lg overflow-hidden">
                                    ${data.thumbnail ? 
                                        `<img src="${data.thumbnail}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\'flex items-center justify-center h-full text-gray-400\'><i class=\'fas fa-video text-3xl\'></i></div>'">` : 
                                        '<div class="flex items-center justify-center h-full text-gray-400"><i class="fas fa-video text-3xl"></i></div>'
                                    }
                                </div>
                            </div>
                            <div class="sm:w-2/3 space-y-3">
                                <h4 class="font-bold text-gray-800 text-sm">${data.title || 'TikTok Video'}</h4>
                                <p class="text-xs text-gray-500">${data.author || '@user'}</p>
                                <div class="flex gap-2">
                                    <span class="quality-badge text-white px-2 py-1 rounded-full text-xs">HD</span>
                                    <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs">No WM</span>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <a href="${data.videoUrl}" target="_blank" rel="noopener noreferrer" class="download-btn text-white py-2 rounded-lg text-center text-sm font-semibold block">
                                        <i class="fas fa-video mr-1"></i>Video
                                    </a>
                                    ${data.audioUrl ? `
                                    <a href="${data.audioUrl}" target="_blank" rel="noopener noreferrer" class="bg-gray-100 text-gray-700 py-2 rounded-lg text-center text-sm font-semibold hover:bg-gray-200 block">
                                        <i class="fas fa-music mr-1"></i>Audio
                                    </a>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>`,
                
                youtube: () => `
                    <div class="result-card bg-white rounded-xl p-4 shadow border-l-4 border-red-600">
                        <div class="flex gap-4">
                            <div class="w-24 h-24 flex-shrink-0 bg-gray-100 rounded-lg overflow-hidden">
                                ${data.thumbnail ? 
                                    `<img src="${data.thumbnail}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\'flex items-center justify-center h-full text-gray-400\'><i class=\'fab fa-youtube text-2xl\'></i></div>'">` : 
                                    '<div class="flex items-center justify-center h-full text-gray-400"><i class="fab fa-youtube text-2xl"></i></div>'
                                }
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-gray-800 text-sm line-clamp-2 mb-2">${data.title || 'YouTube Video'}</h4>
                                <span class="${ytFormat === 'mp3' ? 'format-badge' : 'quality-badge'} text-white px-2 py-1 rounded-full text-xs">${ytFormat === 'mp3' ? 'MP3 Audio' : data.quality || 'HD'}</span>
                                <a href="${data.downloadUrl}" target="_blank" rel="noopener noreferrer" class="mt-2 block w-full download-btn text-white py-2 rounded-lg text-center text-sm font-semibold">
                                    <i class="fas fa-download mr-1"></i>Unduh ${ytFormat.toUpperCase()}
                                </a>
                            </div>
                        </div>
                    </div>`,
                
                instagram: () => data.items && data.items.length > 0 ? `
                    <div class="result-card bg-white rounded-xl p-4 shadow">
                        <h4 class="font-bold text-gray-800 mb-3 text-sm">${data.items.length} Media</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-64 overflow-y-auto">
                            ${data.items.map((item, i) => `
                                <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="relative aspect-square bg-gray-100 rounded-lg overflow-hidden group block">
                                    ${item.type === 'video' ? '<div class="absolute inset-0 flex items-center justify-center z-10"><i class="fas fa-play-circle text-white text-2xl drop-shadow-lg"></i></div>' : ''}
                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition flex items-center justify-center opacity-0 group-hover:opacity-100">
                                        <i class="fas fa-download text-white"></i>
                                    </div>
                                    <div class="absolute top-1 right-1 bg-black text-white text-xs px-1 rounded z-20">${i + 1}</div>
                                </a>
                            `).join('')}
                        </div>
                    </div>` : '<div class="text-red-500 text-center py-4">Tidak ada media</div>',
                
                facebook: () => data.formats && data.formats.length > 0 ? `
                    <div class="result-card bg-white rounded-xl p-4 shadow border-l-4 border-blue-600">
                        <h4 class="font-bold text-gray-800 text-sm mb-3 line-clamp-2">${data.title || 'Facebook Video'}</h4>
                        <div class="grid grid-cols-2 gap-2">
                            ${data.formats.map(f => `
                                <a href="${f.url}" target="_blank" rel="noopener noreferrer" class="bg-blue-50 border-2 border-blue-200 hover:border-blue-400 rounded-lg p-3 text-center transition block">
                                    <div class="font-bold text-blue-700 text-lg">${f.quality}</div>
                                    <div class="text-xs text-blue-500">Kualitas ${f.quality}</div>
                                </a>
                            `).join('')}
                        </div>
                    </div>` : '<div class="text-red-500 text-center py-4">Format tidak ditemukan</div>',
                
                spotify: () => data.downloadUrl ? `
                    <div class="result-card bg-white rounded-xl p-4 shadow border-l-4 border-green-500">
                        <div class="flex gap-4 items-center">
                            <div class="w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0">
                                ${data.thumbnail ? 
                                    `<img src="${data.thumbnail}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\'flex items-center justify-center h-full bg-green-100 text-green-600\'><i class=\'fas fa-music text-2xl\'></i></div>'">` : 
                                    '<div class="flex items-center justify-center h-full bg-green-100 text-green-600"><i class="fas fa-music text-2xl"></i></div>'
                                }
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-gray-800 text-sm truncate">${data.title || 'Unknown Track'}</h4>
                                <p class="text-xs text-gray-500 truncate mb-2">${data.artist || 'Unknown Artist'}</p>
                                <a href="${data.downloadUrl}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center download-btn text-white px-4 py-2 rounded-full text-sm font-semibold">
                                    <i class="fas fa-download mr-2"></i>Unduh MP3
                                </a>
                            </div>
                        </div>
                    </div>` : '<div class="text-red-500 text-center py-4">Link tidak ditemukan</div>',
                
                mediafire: () => data.downloadUrl ? `
                    <div class="result-card bg-white rounded-xl p-4 shadow border-l-4 border-blue-500">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                                <i class="fas fa-file-archive text-xl"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-gray-800 text-sm truncate">${data.filename}</h4>
                                <p class="text-xs text-gray-500">${data.size}</p>
                            </div>
                        </div>
                        <a href="${data.downloadUrl}" target="_blank" rel="noopener noreferrer" class="block w-full download-btn text-white py-3 rounded-lg text-center font-semibold">
                            <i class="fas fa-cloud-download-alt mr-2"></i>Download File
                        </a>
                    </div>` : '<div class="text-red-500 text-center py-4">Link tidak ditemukan</div>',
                
                pinterest: () => data.downloadUrl ? `
                    <div class="result-card bg-white rounded-xl p-4 shadow border-l-4 border-red-700">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <div class="sm:w-1/2">
                                <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
                                    ${data.thumbnail ? 
                                        `<img src="${data.thumbnail}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\'flex items-center justify-center h-full text-gray-400\'><i class=\'fas fa-image text-4xl\'></i></div>'">` : 
                                        '<div class="flex items-center justify-center h-full text-gray-400"><i class="fas fa-image text-4xl"></i></div>'
                                    }
                                </div>
                            </div>
                            <div class="sm:w-1/2 space-y-4">
                                <h4 class="font-bold text-gray-800">${data.title || 'Pinterest Image'}</h4>
                                <a href="${data.downloadUrl}" target="_blank" rel="noopener noreferrer" class="block w-full download-btn text-white py-3 rounded-lg text-center font-semibold">
                                    <i class="fas fa-download mr-2"></i>Unduh Gambar
                                </a>
                            </div>
                        </div>
                    </div>` : '<div class="text-red-500 text-center py-4">Gambar tidak ditemukan</div>'
            };
            
            content.innerHTML = (renderers[currentPlatform] || (() => '<div class="text-red-500 text-center py-4">Platform error</div>'))();
            div.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ============================================
        // UTILITIES
        // ============================================
        
        function clearResults() {
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('errorSection').classList.add('hidden');
            document.getElementById('urlInput').value = '';
        }

        function retryDownload() {
            if (lastUrl) {
                document.getElementById('urlInput').value = lastUrl;
                startDownload();
            }
        }

        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const text = document.getElementById('toastMessage');
            
            text.textContent = msg;
            icon.className = `fas ${
                type === 'error' ? 'fa-exclamation-circle text-red-500' : 
                type === 'info' ? 'fa-info-circle text-blue-500' : 
                'fa-check-circle text-green-500'
            } text-xl`;
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Init
        console.log('AllDownloader initialized with new APIs');
    </script>

</body>
</html>
